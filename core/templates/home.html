<!DOCTYPE html>
<html>
<head>
  <title>Maps Test</title>
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />

  <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/home.css">
  <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/bootstrap.css">
  
  <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyClqmnPFZDxh_XIktPvuNQuo8F7mQ86ORc&sensor=FALSE"></script>
  <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=places"></script>
  <script src="//code.jquery.com/jquery-1.10.2.js"></script>
  <script src="{{ STATIC_URL }}js/bootstrap.min.js"></script>
  
  <script type="text/javascript" src="{{ STATIC_URL }}js/drawing_maps.js"></script>
  <script type="text/javascript" src="{{ STATIC_URL }}js/creating_polygons.js"></script>
  <script type="text/javascript" src="{{ STATIC_URL }}js/search_box.js"></script>

  <script type="text/javascript">
    $( document ).ready(function() {
      $( "#searchTextField" ).keypress(function(event) {
        if ( event.which == 13 ) {
          codeAddress();
        }
      });
    });
  </script>

  <script type="text/javascript">
    var map;

    function initialize() {
      document.getElementById("end_drawing").disabled = true;

      geocoder = new google.maps.Geocoder();
      var input = document.getElementById('searchTextField');
      var autocomplete = new google.maps.places.Autocomplete(input);
      
      var mapOptions = {
        center: new google.maps.LatLng(43.64719534917825, -79.39072608947754),
        zoom: 13
      };
      map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);

      google.maps.event.addListener(map, 'click', function (e) {
        if (drawing==true){
          var currentPath = polygon.getPath();
          currentPath.push(e.latLng);
        }
      });

      // GENERATING THE STORED POLYGONS
      {% for polygon in polygons %}
        var polygon_points = "{{ polygon.points }}".split(", ");
        var polygon_color = "{{ polygon.color }}";
        var polygon_info_text = "{{ polygon.info_text }}";
        var polygon_path = [];

        for(i=0; i<polygon_points.length-1; i=i+2){
          var coordenate1 = polygon_points[i].substring(1);
          var coordenate2 = polygon_points[i+1].substring(0, polygon_points[i+1].length-1);
          var latlng = new google.maps.LatLng(coordenate1, coordenate2);
          polygon_path.push(latlng);
        }

        polygon = new_polygon(map, polygon_path, polygon_color, polygon_info_text, false, false);
      {% endfor %}

    }
    google.maps.event.addDomListener(window, 'load', initialize);
  </script>
</head>

<body>
  <form method="POST", action="/new_map/" name="new_map_form">
    {% csrf_token %}
    <input type="hidden" name="points">
    <input type="hidden" name="color" id="id_color">
    <input type="hidden" name="info_text">
  </form>

  <div class="my_header">
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container-fluid">
        <div class="navbar-header">
          <a class="navbar-brand" href="/">Phosphorus Media - Drawing Maps</a>
        </div>

        <div class="navbar-collapse collapse">
          <div class="navbar-form navbar-right">
            <input id="searchTextField" type="textbox" class="form-control controls" placeholder="Enter location">
            <button onclick="codeAddress()" class="btn btn-default">Search</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  
  <div id="draw_maps_box" class="form-horizontal">
    <h3>Drawing Maps</h3>
    <div class="form-group">
      <label class="col-sm-6 control-label">Color</label>
      <div class="col-sm-3">
        <input type="color" class="form-control" id="color">
      </div>
    </div>
    <div class="form-group">
      <div class="col-sm-12">
        <textarea class="form-control" rows="6" id="info_text"></textarea><br>
      </div>
    </div>
    <div class="form-group">
      <div class="col-sm-6">
        <button class="btn btn-default" onclick="start_drawing()" id="start_drawing">Start Drawing</button>
      </div>
      <div class="col-sm-6">
        <button class="btn btn-default" onclick="end_drawing()" id="end_drawing">End Drawing</button>
      </div>
    </div>

  </div>

  <div id="filters_box">
    {% for color, value in colors %}
      <a href="/filter/{{ value }}/"><div style="background-color: {{ color }};" class="filter_color_box"></div></a>
    {% endfor %}
    <a href=/><div class="filter_color_box">All</div></a>
  </div>

  <div id="map-canvas"/>  
</body>
</html>